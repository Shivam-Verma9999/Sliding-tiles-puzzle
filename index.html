<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
    <link rel="stylesheet" href="./index.css">
    <title>Sliding Tiles Puzzle</title>
</head>

<body>

    <header>
        <div>Sliding Tiles Puzzle</div>
    </header>

    <div style="position: relative;">
        <div class="selectImage">
            <div>Select Image</div>
            <div style="max-height:100%;">
                <img src="./images/img1.jpg" onclick="changeImage(this)">
                <img src="./images/img2.jpg" onclick="changeImage(this)">
            </div>
        </div>
        <div class="puzzleContainer">
            <div class="puzzlePiece">1</div>
            <div class="puzzlePiece">2</div>
            <div class="puzzlePiece">3</div>
            <div class="puzzlePiece">4</div>
            <div class="puzzlePiece">5</div>
            <div class="puzzlePiece">6</div>
            <div class="puzzlePiece">7</div>
            <div class="puzzlePiece">8</div>
            <div class="puzzlePiece" style="display: none;"></div>
            <div class="differ"></div>
        </div>
        <div class="controls">

            <button id="toggle" onclick="showNumbers()">Hide numbers</button>
            <button onclick="solve()">Solve</button>
        </div>

        <div class="info">
            <h1 style="color: rgba(0,0,0,0.7);">Instructions</h1>
            <ul>
                <li>Use arrow keys or A,W,S,D keys to move the tiles</li>
                <br>
                <li>Arrange tiles so that they match the image to win the game </li>
            </ul>

            <div class="score">
                <!-- <b>Score:-</b> <span id="score"> 100</span> -->
                <br>
                <b>Total moves:-</b> <span id="totalMoves">0</span>
                <br>
                <button onclick="newGame();">New Game</button>

            </div>

        </div>
    </div>


</body>
<script>
    // listener for keyboard events
    window.addEventListener('keypress', (event) => {
        console.log(event.key);
        if (event.key === 't' || event.key === 'T') {
            showNumbers();
        } else {
            move(event.key);
        }

    });

    // presents the present positions of puzzle pieces
    // example :- piecesPositions[0] represent the position of 1st tile in container which is 1
    // piecesPositions[1] represents the position of 2nd tile in container which is 2
    //     
    // rearrange values in this array to change the initial positions of tiles
    let piecesPositions = [1, 2, 3, 4, 5, 6, 7, 8, 9];

    // this piece is transparent
    // ignore this
    let blankPieceNum = 9 - 1;

    // reference to span that displays total moves
    let totalMoves = document.querySelector('#totalMoves');

    // this sets the positions of the tiles in the Game as given in the piecesPositions array
    function setPositions() {
        let puzzlePieces = document.querySelectorAll('.puzzlePiece');
        for (let i = 0; i < puzzlePieces.length; i++) {

            let ycord = piecesPositions[i]
            let xTransPerc = ((piecesPositions[i] - 1) % 3) * 100;
            let yTransPerc = Math.floor((piecesPositions[i] - 1) / 3) * 100;
            puzzlePieces[i].style.transform = 'translate(' + xTransPerc + '% ,' + yTransPerc + '% )';
        }
    }

    // give positions to the tiles according to array piecesPositions
    setPositions();


    // tile number visible/invisible  flag
    // 1 if visible
    // 0 if hidden
    let numbersVisible = 1;

    // toggles whether the tile number is visible or not
    function showNumbers() {
        let element = document.querySelector('#toggle');
        let puzzlePiece = document.querySelectorAll('.puzzlePiece');
        for (let i = 0; i < puzzlePiece.length; i++) {
            puzzlePiece[i].style.color = (numbersVisible == 1) ? "transparent" : "white";
        };
        numbersVisible = (numbersVisible == 0) ? 1 : 0;
        element.innerHTML = (numbersVisible == 1) ? "Hide numbers" : "Show numbers";
    }

    // move the tile pieces according to the button pressed on keyboard
    // ========ACTUATERS==========
    function move(key) {
        let tileMoved = false;
        switch (key) {
            case 'd':
            case 'D':
            case 'ArrowRight':
                if (((piecesPositions[blankPieceNum] - 1) % 3) > 0) {
                    piecesPositions[blankPieceNum]--;

                    let movedToPos = piecesPositions[blankPieceNum];
                    piecesPositions[piecesPositions.indexOf(movedToPos)] += 1;
                    tileMoved = true;
                };
                break;

            case 'a':
            case 'A':
            case 'ArrowLeft':
                if (((piecesPositions[blankPieceNum] - 1) % 3) < 2) {
                    piecesPositions[blankPieceNum] += 1;
                    let movedToPos = piecesPositions[blankPieceNum];
                    piecesPositions[piecesPositions.indexOf(movedToPos)] -= 1;
                    tileMoved = true;
                };
                break;

            case 'W':
            case 'w':
            case 'ArrowUp':
                if (Math.floor((piecesPositions[blankPieceNum] - 1) / 3) < 2) {
                    piecesPositions[blankPieceNum] += 3;
                    let movedToPos = piecesPositions[blankPieceNum];
                    piecesPositions[piecesPositions.indexOf(movedToPos)] -= 3;
                    tileMoved = true;
                };
                break;

            case 's':
            case 'S':
            case 'ArrowDown':
                if (Math.floor((piecesPositions[blankPieceNum] - 1) / 3) > 0) {
                    piecesPositions[blankPieceNum] -= 3;
                    let movedToPos = piecesPositions[blankPieceNum];
                    piecesPositions[piecesPositions.indexOf(movedToPos)] += 3;
                    tileMoved = true;
                };
                break;

            default:
                break;
        }
        if (tileMoved) {
            setPositions();
            increaseTotalMoves();
            if (checkWin()) {
                alert("Winner Winner Chicken ....... (You know next word)\ntotalmoves:- " + totalMoves.innerHTML +
                    "\nStarting new game");
                newGame();
            }
        }
    }

    // jo karna ko karlo
    function solve() {
        alert("sabkuch thode he kar dunga.");
    }

    // bigad do
    function scramble() {
        piecesPositions.reverse();
        setPositions();
    }

    function changeImage(imgElement) {
        let src = imgElement.attributes.src.value;
        console.log(src);
        let puzzleContainer = document.querySelector('.puzzleContainer');
        puzzleContainer.style.backgroundImage = 'url(' + src + ')';

        document.querySelectorAll('.puzzlePiece').forEach((img) => {
            img.style.backgroundImage = 'url(' + src + ')';
        });

    }

    //increase total Moves count
    function increaseTotalMoves(resetGame = undefined) {

        totalMoves.innerHTML = (parseInt(totalMoves.innerHTML)) + 1;
        if (resetGame != undefined) totalMoves.innerHTML = 0;
    }

    // Reset game
    // rearrange tile positions 
    // Reset totalMoves to Zero
    function newGame() {
        piecesPositions = [1, 2, 3, 4, 5, 6, 7, 8, 9];
        scramble();
        setPositions();
        increaseTotalMoves(resetGame = true);
    }


    // checks whether tiles are in correct sequence or not 
    function checkWin() {
        let i = 1;
        let wonStatus = true;
        piecesPositions.forEach((element) => {
            if (i != element) {
                wonStatus = false;
            };
            i++;
        });
        return wonStatus;
    }
</script>

</html>